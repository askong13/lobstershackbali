    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places&callback=initMaps" async defer></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mcstudios/glightbox/dist/js/glightbox.min.js"></script>

    <script>
        'use strict';
        
        // Fungsi untuk mengambil konfigurasi dan memulai aplikasi
        async function initializeApp() {
            try {
                // 1. Ambil konfigurasi dari Netlify Function
                const response = await fetch('/.netlify/functions/get-firebase-config');
                const firebaseConfig = await response.json();

                // 2. Inisialisasi Firebase dengan konfigurasi yang didapat
                firebase.initializeApp(firebaseConfig);
                const db = firebase.firestore();

                // 3. Jalankan sisa logika aplikasi setelah Firebase siap
                runApp(db);

            } catch (error) {
                console.error("Gagal menginisialisasi Firebase:", error);
                document.body.innerHTML = "<h1>Error: Gagal memuat konfigurasi. Silakan coba lagi nanti.</h1>";
            }
        }

        function runApp(db) {
            // Seluruh kode JavaScript Anda dari `DOMContentLoaded` sebelumnya
            // dipindahkan ke dalam fungsi ini.
            
            let currentLanguage = localStorage.getItem('preferredLanguage') || 'id';
            let siteData = {};
            
            // --- FUNGSI RENDER ---
            function renderContent() {
                // ... (fungsi renderContent sama seperti sebelumnya)
            }
            // ... (semua fungsi render lainnya juga sama)

            // --- FUNGSI UTAMA PENGAMBIL DATA ---
            async function fetchAllData() {
                const collections = ['products', 'categories', 'content', 'banners', 'gallery_images', 'history'];
                const promises = collections.map(col => db.collection(col).get());
                
                // ... (sisa fungsi fetchAllData sama seperti sebelumnya)
                // ... (pastikan semua referensi `db` sudah benar)
                
                // Setelah semua data siap, render seluruh halaman
                renderAll();
            }

            function renderAll() {
                 // ... (fungsi renderAll sama seperti sebelumnya)
            }

            // ... (Semua fungsi dan event listener lainnya dipindahkan ke sini)

            fetchAllData();
            // ... (setup event listeners, dll.)
        }

        // Mulai aplikasi
        initializeApp();
    </script>
</body>
</html>
