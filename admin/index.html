<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Lobster Shack Bali</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>

    <div id="auth-container">
        <div class="login-card">
            <img src="https://lh3.googleusercontent.com/d/1GIdbd0F7kn0O4L8qEr-25GXSEWbLNVj9" class="logo">
            <h1>Admin Panel Login</h1>
            <form id="login-form">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn" style="width: 100%;">Login</button>
                <div id="login-error" class="error-message"></div>
            </form>
        </div>
    </div>

    <div id="admin-container" style="display: none;">
        <button class="menu-toggle"><i class="fas fa-bars"></i></button>

        <aside class="sidebar">
            <div class="logo-container">
                <img src="https://lh3.googleusercontent.com/d/1GIdbd0F7kn0O4L8qEr-25GXSEWbLNVj9" alt="Logo" class="logo">
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="#dashboard" class="nav-link active"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                    <li><a href="#banners" class="nav-link"><i class="fas fa-images"></i> Banners</a></li>
                    <li><a href="#history" class="nav-link"><i class="fas fa-landmark"></i> History</a></li>
                    <li><a href="#gallery" class="nav-link"><i class="fas fa-photo-video"></i> Gallery</a></li>
                    <li><a href="#products" class="nav-link"><i class="fas fa-utensils"></i> Products</a></li>
                    <li><a href="#categories" class="nav-link"><i class="fas fa-tags"></i> Categories</a></li>
                    <li><a href="#content" class="nav-link"><i class="fas fa-file-alt"></i> Content</a></li>
                    <li><a href="#orders" class="nav-link"><i class="fas fa-receipt"></i> Pesanan</a></li>
                    <li><a href="#pos" class="nav-link"><i class="fas fa-cash-register"></i> POS</a></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <a href="#" id="logout-btn" class="logout-btn nav-link"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
        </aside>

        <main class="main-content">
            <section id="page-dashboard" class="page active">
                 <div class="page-header"><h1>Dashboard</h1></div>
                 <div class="card"><div class="coming-soon-card"><i class="fas fa-chart-line"></i><h2>Analytics Coming Soon</h2><p>We are working on bringing you insightful analytics about your sales, popular products, and more.</p></div></div>
            </section>
            
            <section id="page-banners" class="page">
                <div class="page-header"><h1>Manage Banners</h1><button class="btn" id="add-new-banner-btn"><i class="fas fa-plus"></i> Add New</button></div>
                <div class="card"><div class="table-wrapper"><table id="banners-table"><thead><tr><th>Image</th><th>Sort Order</th><th>Actions</th></tr></thead><tbody></tbody></table></div></div>
            </section>

            <section id="page-history" class="page">
                <div class="page-header"><h1>Manage History / About Us Article</h1></div>
                <div class="card">
                    <div class="table-wrapper">
                        <table id="history-table">
                            <thead><tr><th>Title (ID/EN)</th><th>Content Preview</th><th>Actions</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                     <div class="info-card" style="margin-top: 2rem; background-color: #f0f8ff; padding: 1rem; border-radius: 8px;">
                        <strong>Note:</strong> Only one "History" article is displayed on the website. If you add more than one, only the first one will be shown. You can edit the existing one.
                    </div>
                </div>
            </section>

            <section id="page-gallery" class="page">
                <div class="page-header"><h1>Manage Gallery</h1><button class="btn" id="add-new-gallery-btn"><i class="fas fa-plus"></i> Add New</button></div>
                <div class="card"><div class="table-wrapper"><table id="gallery-table"><thead><tr><th>Image</th><th>Sort Order</th><th>Caption (ID/EN)</th><th>Actions</th></tr></thead><tbody></tbody></table></div></div>
            </section>

            <section id="page-products" class="page">
                <div class="page-header"><h1>Manage Products</h1><button class="btn" id="add-new-product-btn"><i class="fas fa-plus"></i> Add New</button></div>
                <div class="card"><div class="table-wrapper"><table id="products-table"><thead><tr><th>Image</th><th>Name (ID/EN)</th><th>Category</th><th>Price</th><th>Featured</th><th>Actions</th></tr></thead><tbody></tbody></table></div></div>
            </section>

            <section id="page-categories" class="page">
                <div class="page-header"><h1>Manage Categories</h1><button class="btn" id="add-new-category-btn"><i class="fas fa-plus"></i> Add New</button></div>
                <div class="card"><div class="table-wrapper"><table id="categories-table"><thead><tr><th>Sort Order</th><th>Name</th><th>Actions</th></tr></thead><tbody></tbody></table></div></div>
            </section>

            <section id="page-content" class="page">
                 <div class="page-header"><h1>Manage Website Content</h1></div>
                 <div class="card"><div class="table-wrapper"><table id="content-table"><thead><tr><th>Key</th><th>Text (ID)</th><th>Text (EN)</th><th>Image</th><th>Action</th></tr></thead><tbody></tbody></table></div></div>
            </section>

            <section id="page-orders" class="page">
                 <div class="page-header"><h1>Pesanan</h1></div>
                 <div class="card"><div class="coming-soon-card"><i class="fas fa-receipt"></i><h2>Order Management Coming Soon</h2><p>A dedicated interface to view and manage all incoming customer orders will be available here.</p></div></div>
            </section>

            <section id="page-pos" class="page">
                 <div class="page-header"><h1>Point of Sale (POS)</h1></div>
                 <div class="card"><div class="coming-soon-card"><i class="fas fa-cash-register"></i><h2>POS System Coming Soon</h2><p>An integrated Point of Sale system for handling on-site orders is under development.</p></div></div>
            </section>
        </main>
    </div>
    
    <div id="banner-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;"><div class="modal-header"><h2 id="banner-modal-title"></h2><button class="modal-close-btn">×</button></div><div class="modal-body"><form id="banner-form"><input type="hidden" id="banner-id"><div class="form-group"><label for="banner-sort-order">Sort Order</label><input type="number" id="banner-sort-order" required><small>Lower number appears first.</small></div><div class="form-group"><label for="banner-image">Banner Image</label><input type="file" id="banner-image" accept="image/*"><img id="banner-image-preview" src="#" alt="Preview" class="image-preview"></div><div style="text-align: right;"><button type="submit" class="btn btn-secondary"><i class="fas fa-save"></i> Save</button></div></form></div></div>
    </div>
    <div id="gallery-modal" class="modal-overlay">
        <div class="modal-content"><div class="modal-header"><h2 id="gallery-modal-title"></h2><button class="modal-close-btn">×</button></div><div class="modal-body"><form id="gallery-form"><input type="hidden" id="gallery-id"><div class="form-group"><label for="gallery-sort-order">Sort Order</label><input type="number" id="gallery-sort-order" required></div><div class="form-grid"><div class="form-group"><label for="gallery-caption-id">Caption (ID)</label><input type="text" id="gallery-caption-id" required></div><div class="form-group"><label for="gallery-caption-en">Caption (EN)</label><input type="text" id="gallery-caption-en" required></div></div><div class="form-group"><label for="gallery-image">Image</label><input type="file" id="gallery-image" accept="image/*"><img id="gallery-image-preview" src="#" alt="Preview" class="image-preview"></div><div style="text-align: right;"><button type="submit" class="btn btn-secondary"><i class="fas fa-save"></i> Save</button></div></form></div></div>
    </div>
    
    <div id="history-modal" class="modal-overlay">
        <div class="modal-content"><div class="modal-header"><h2 id="history-modal-title"></h2><button class="modal-close-btn">×</button></div><div class="modal-body"><form id="history-form"><input type="hidden" id="history-id"><div class="form-grid"><div class="form-group"><label for="history-title-id">Title (ID)</label><input type="text" id="history-title-id" required></div><div class="form-group"><label for="history-title-en">Title (EN)</label><input type="text" id="history-title-en" required></div></div><div class="form-group"><label for="history-text-id">Text / Article (ID)</label><textarea id="history-text-id" required rows="6"></textarea></div><div class="form-group"><label for="history-text-en">Text / Article (EN)</label><textarea id="history-text-en" required rows="6"></textarea></div><div style="text-align: right;"><button type="submit" class="btn btn-secondary"><i class="fas fa-save"></i> Save</button></div></form></div></div>
    </div>

    <div id="product-modal" class="modal-overlay">
        <div class="modal-content"><div class="modal-header"><h2 id="product-modal-title"></h2><button class="modal-close-btn">×</button></div><div class="modal-body"><form id="product-form"><input type="hidden" id="product-id"><div class="form-grid"><div class="form-group"><label for="product-name-id">Name (ID)</label><input type="text" id="product-name-id" required></div><div class="form-group"><label for="product-name-en">Name (EN)</label><input type="text" id="product-name-en" required></div></div><div class="form-group"><label for="product-description-id">Description (ID)</label><textarea id="product-description-id" required></textarea></div><div class="form-group"><label for="product-description-en">Description (EN)</label><textarea id="product-description-en" required></textarea></div><div class="form-grid"><div class="form-group"><label for="product-price">Price (IDR)</label><input type="number" id="product-price" required></div><div class="form-group"><label for="product-category">Category</label><select id="product-category" required></select></div></div>
            <div class="form-grid">
                <div class="form-group">
                    <label for="product-gofood-link">GoFood Link (Optional)</label>
                    <input type="url" id="product-gofood-link" placeholder="https://gofood.link/...">
                </div>
                <div class="form-group">
                    <label for="product-grabfood-link">GrabFood Link (Optional)</label>
                    <input type="url" id="product-grabfood-link" placeholder="https://grab.onelink.me/...">
                </div>
            </div>
            <div class="form-group"><label for="product-image">Image</label><input type="file" id="product-image" accept="image/*"><img id="product-image-preview" src="#" alt="Preview" class="image-preview"></div><div class="form-group"><div class="form-check"><input type="checkbox" id="product-featured"><label for="product-featured">Is this a featured product?</label></div></div><div style="text-align: right;"><button type="submit" class="btn btn-secondary"><i class="fas fa-save"></i> Save</button></div></form></div></div>
    </div>
    <div id="category-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;"><div class="modal-header"><h2 id="category-modal-title"></h2><button class="modal-close-btn">×</button></div><div class="modal-body"><form id="category-form"><input type="hidden" id="category-id"><div class="form-group"><label for="category-name">Name</label><input type="text" id="category-name" required></div><div class="form-group"><label for="category-sort-id">Sort Order</label><input type="number" id="category-sort-id" required><small>Lower number appears first.</small></div><div style="text-align: right;"><button type="submit" class="btn btn-secondary"><i class="fas fa-save"></i> Save</button></div></form></div></div>
    </div>
    <div id="content-modal" class="modal-overlay">
        <div class="modal-content"><div class="modal-header"><h2 id="content-modal-title"></h2><button class="modal-close-btn">×</button></div><div class="modal-body"><form id="content-form"><input type="hidden" id="content-key"><p>Editing key: <strong id="content-key-display"></strong></p><div class="form-group"><label for="content-text-id">Text (ID)</label><textarea id="content-text-id" required></textarea></div><div class="form-group"><label for="content-text-en">Text (EN)</label><textarea id="content-text-en" required></textarea></div><div class="form-group"><label for="content-image">Image (Optional)</label><input type="file" id="content-image" accept="image/*"><img id="content-image-preview" src="#" alt="Preview" class="image-preview"></div><div style="text-align: right;"><button type="submit" class="btn btn-secondary"><i class="fas fa-save"></i> Save</button></div></form></div></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    
    <script src="assets/js/admin.js"></script>
    <script>
        // Override admin.js functions to match new History/About Us design
        document.addEventListener('DOMContentLoaded', () => {
            // Wait for the main admin script to load and initialize
            setTimeout(() => {
                const originalRenderHistory = window.renderHistory;
                window.renderHistory = () => {
                     const renderTable = (tableId, data, rowRenderer) => {
                        const tbody = document.querySelector(`#${tableId} tbody`);
                        if(!tbody) return;
                        tbody.innerHTML = data.map(rowRenderer).join('') || `<tr><td colspan="100%" style="text-align:center; padding: 2rem;">No article found. Please add one.</td></tr>`;
                    };
                     const renderActionButtons = (collection, id, name) => `
                        <div class="action-btns">
                            <button class="btn btn-sm btn-outline" onclick="editItem('${collection}', '${id}')"><i class="fas fa-edit"></i> Edit</button>
                        </div>`;

                    renderTable('history-table', historyData, h => `
                        <tr>
                            <td data-label="Title">${h.title_id}<br><small class="text-muted">${h.title_en}</small></td>
                            <td data-label="Content Preview">${(h.text_en || '').substring(0, 80)}...</td>
                            <td data-label="Actions">${renderActionButtons('history', h.id, h.title_en)}</td>
                        </tr>
                    `);
                };

                const originalSetupForms = window.setupForms;
                window.setupForms = () => {
                    originalSetupForms(); // Call original function
                     if(document.getElementById('add-new-history-btn')) {
                       document.getElementById('add-new-history-btn').style.display = 'none'; // Hide add button
                    }
                    // Override history form submission
                    document.getElementById('history-form').addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const id = document.getElementById('history-id').value;
                        const data = {
                            title_id: document.getElementById('history-title-id').value,
                            title_en: document.getElementById('history-title-en').value,
                            text_id: document.getElementById('history-text-id').value,
                            text_en: document.getElementById('history-text-en').value
                        };
                        // Remove year and sort_order if they exist
                        delete data.year;
                        delete data.sort_order;

                        try {
                            await saveToDb('history', id, data);
                            closeModal('history-modal');
                            await loadHistory();
                            renderHistory();
                        } catch (err) {
                            alert("Error saving history article: " + err.message);
                        }
                    });
                };

                 const originalEditItem = window.editItem;
                 window.editItem = (collection, id) => {
                    if (collection === 'history') {
                        const item = historyData.find(i => i.id === id);
                        if (!item) return;
                        const modalId = 'history-modal';
                        const formId = 'history-form';
                        const modalTitle = 'Edit History Article';

                        resetForm(formId, 'history-modal-title', modalTitle);
                        document.getElementById('history-id').value = item.id || '';
                        document.getElementById('history-title-id').value = item.title_id || '';
                        document.getElementById('history-title-en').value = item.title_en || '';
                        document.getElementById('history-text-id').value = item.text_id || '';
                        document.getElementById('history-text-en').value = item.text_en || '';
                        openModal(modalId);
                    } else {
                        originalEditItem(collection, id);
                    }
                };

                // Re-initialize to apply overrides
                if (window.auth && window.auth.currentUser) {
                    setupForms();
                    renderHistory();
                }

            }, 500); // Delay to ensure admin.js is loaded
        });
    </script>
</body>
</html>
