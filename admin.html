// Pastikan Firebase SDK dan Auth sudah terinisialisasi
// import { getAuth, onAuthStateChanged } from "firebase/auth";
// import { getFirestore, collection, getDocs, onSnapshot, query, orderBy } from "firebase/firestore";

// const auth = getAuth(app);
// const db = getFirestore(app);

// Fungsi untuk memuat pesanan di dashboard admin
function loadOrdersForAdmin() {
    const ordersTableBody = document.getElementById('orders-table-body'); // Pastikan ID ini ada
    if (!ordersTableBody) return; // Keluar jika elemen tidak ditemukan

    // Gunakan onSnapshot untuk real-time updates
    const q = query(collection(db, "orders"), orderBy("order_date", "desc"));

    onSnapshot(q, (snapshot) => {
        ordersTableBody.innerHTML = ''; // Bersihkan tabel
        if (snapshot.empty) {
            ordersTableBody.innerHTML = '<tr><td colspan="5">No new orders.</td></tr>';
            console.log("No orders found.");
            return;
        }

        let totalOrdersToday = 0;
        const today = new Date();
        today.setHours(0, 0, 0, 0); // Reset waktu ke awal hari

        snapshot.forEach((doc) => {
            const order = doc.data();
            const orderDate = order.order_date ? order.order_date.toDate() : new Date(); // Pastikan order_date ada

            // Periksa jika pesanan dari hari ini
            if (orderDate.getFullYear() === today.getFullYear() &&
                orderDate.getMonth() === today.getMonth() &&
                orderDate.getDate() === today.getDate()) {
                totalOrdersToday++;
            }

            const row = ordersTableBody.insertRow();
            row.innerHTML = `
                <td>${doc.id}</td>
                <td>${order.customer_name || 'N/A'}</td>
                <td>Rp ${order.total_amount ? order.total_amount.toLocaleString('id-ID') : '0'}</td>
                <td>${order.status || 'N/A'}</td>
                <td>${orderDate.toLocaleString()}</td>
            `;
        });

        document.getElementById('orders-today-count').innerText = totalOrdersToday; // Perbarui counter di dashboard
        console.log("Orders loaded successfully for admin dashboard.");
    }, (error) => {
        console.error("Error loading orders for admin: ", error);
        document.getElementById('orders-table-body').innerHTML = `<tr><td colspan="5">Error loading orders: ${error.message}</td></tr>`;
        document.getElementById('orders-today-count').innerText = 'Error';
    });
}

// Panggil fungsi ini setelah user terautentikasi di admin.html
onAuthStateChanged(auth, (user) => {
    if (user) {
        console.log("Admin user logged in:", user.email);
        loadOrdersForAdmin(); // Memuat pesanan
        // Panggil fungsi lain untuk memuat produk, kategori, dll. untuk admin panel
    } else {
        console.log("No admin user logged in. Redirecting to login.");
        // Mungkin redirect ke halaman login
    }
});
